generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id               String                   @id @default(cuid())
  name             String?
  email            String                   @unique
  emailVerified    DateTime?
  image            String?
  password         String?
  role             Role                     @default(USER)
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime                 @updatedAt
  accounts         Account[]
  comments         Comment[]
  meetings         Meeting[]
  notifications    Notification[]
  reviews          Review[]
  applicationReviews ApplicationReview[]
  sessions         Session[]
  sponsorships     Sponsorship[]            @relation("SponsorToSponsorship")
  startups         Startup[]                @relation("FounderToStartup")
  startupCalls     StartupCall[]
  callApplications StartupCallApplication[]
  tasks            Task[]                   @relation("AssigneeToTask")
  createdTasks     Task[]                   @relation("CreatorToTask")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Startup {
  id               String                   @id @default(cuid())
  name             String
  description      String
  pitch            String
  industry         String[]
  stage            String
  website          String?
  logo             String?
  founderId        String
  status           Status                   @default(SUBMITTED)
  score            Float?
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime                 @updatedAt
  comments         Comment[]
  documents        Document[]
  financials       Financial[]
  meetings         Meeting[]
  milestones       Milestone[]
  reviews          Review[]
  sponsorships     Sponsorship[]
  founder          User                     @relation("FounderToStartup", fields: [founderId], references: [id])
  callApplications StartupCallApplication[]
  tasks            Task[]
}

model Review {
  id             String   @id @default(cuid())
  startupId      String
  reviewerId     String
  score          Float
  feedback       String
  recommendation String
  status         String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  reviewer       User     @relation(fields: [reviewerId], references: [id])
  startup        Startup  @relation(fields: [startupId], references: [id])
}

model Milestone {
  id            String    @id @default(cuid())
  startupId     String
  title         String
  description   String
  dueDate       DateTime
  completedDate DateTime?
  status        String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  startup       Startup   @relation(fields: [startupId], references: [id])
  tasks         Task[]
}

model Task {
  id            String     @id @default(cuid())
  title         String
  description   String
  status        String
  priority      String
  startDate     DateTime
  dueDate       DateTime
  completedDate DateTime?
  startupId     String
  milestoneId   String?
  assigneeId    String?
  creatorId     String
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  assignee      User?      @relation("AssigneeToTask", fields: [assigneeId], references: [id])
  creator       User       @relation("CreatorToTask", fields: [creatorId], references: [id])
  milestone     Milestone? @relation(fields: [milestoneId], references: [id])
  startup       Startup    @relation(fields: [startupId], references: [id])
}

model Document {
  id          String   @id @default(cuid())
  startupId   String
  name        String
  description String?
  fileUrl     String
  fileType    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  startup     Startup  @relation(fields: [startupId], references: [id])
}

model Sponsorship {
  id          String    @id @default(cuid())
  startupId   String
  sponsorId   String
  amount      Float
  currency    String
  description String?
  status      String
  startDate   DateTime
  endDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  sponsor     User      @relation("SponsorToSponsorship", fields: [sponsorId], references: [id])
  startup     Startup   @relation(fields: [startupId], references: [id])
}

model Financial {
  id          String   @id @default(cuid())
  startupId   String
  type        String
  category    String
  amount      Float
  currency    String
  description String?
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  startup     Startup  @relation(fields: [startupId], references: [id])
}

model Meeting {
  id          String   @id @default(cuid())
  startupId   String
  userId      String
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  location    String?
  meetingUrl  String?
  status      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  startup     Startup  @relation(fields: [startupId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
}

model Comment {
  id        String    @id @default(cuid())
  startupId String
  userId    String
  content   String
  parentId  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  parent    Comment?  @relation("CommentToReply", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentToReply")
  startup   Startup   @relation(fields: [startupId], references: [id])
  user      User      @relation(fields: [userId], references: [id])
}

model StartupCall {
  id                  String                   @id @default(cuid())
  title               String
  description         String
  status              StartupCallStatus        @default(DRAFT)
  applicationDeadline DateTime
  publishedDate       DateTime?
  industry            String
  location            String
  fundingAmount       String?
  requirements        String[]
  eligibilityCriteria String[]
  selectionProcess    String[]
  aboutSponsor        String?
  applicationProcess  String
  createdById         String
  createdAt           DateTime                 @default(now())
  updatedAt           DateTime                 @updatedAt
  createdBy           User                     @relation(fields: [createdById], references: [id])
  applications        StartupCallApplication[]
}

model StartupCallApplication {
  id                   String                       @id @default(cuid())
  callId               String
  startupId            String?
  userId               String
  startupName          String
  website              String?
  foundingDate         DateTime
  teamSize             String
  industry             String
  stage                String
  description          String
  problem              String
  solution             String
  traction             String?
  businessModel        String
  funding              String?
  useOfFunds           String
  competitiveAdvantage String
  founderBio           String
  pitchDeckUrl         String?
  financialsUrl        String?
  status               StartupCallApplicationStatus @default(SUBMITTED)
  reviewsCompleted     Int                          @default(0)
  reviewsTotal         Int                          @default(3)
  submittedAt          DateTime                     @default(now())
  updatedAt            DateTime                     @updatedAt
  call                 StartupCall                  @relation(fields: [callId], references: [id])
  startup              Startup?                     @relation(fields: [startupId], references: [id])
  user                 User                         @relation(fields: [userId], references: [id])
  reviews              ApplicationReview[]
}

model ApplicationReview {
  id              String               @id @default(cuid())
  applicationId   String
  reviewerId      String
  score           Float?
  innovationScore Float?
  marketScore     Float?
  teamScore       Float?
  executionScore  Float?
  feedback        String?
  status          ReviewStatus         @default(PENDING)
  assignedAt      DateTime             @default(now())
  dueDate         DateTime?
  completedAt     DateTime?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  application     StartupCallApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  reviewer        User                 @relation(fields: [reviewerId], references: [id])

  @@unique([applicationId, reviewerId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String
  read      Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Event {
  id          String   @id @default(cuid())
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime
  location    String?
  eventUrl    String?
  isPublic    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum Role {
  USER
  ENTREPRENEUR
  REVIEWER
  SPONSOR
  ADMIN
}

enum Status {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
  COMPLETED
}

enum StartupCallStatus {
  DRAFT
  PUBLISHED
  CLOSED
  ARCHIVED
}

enum StartupCallApplicationStatus {
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  WITHDRAWN
}

enum ReviewStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  OVERDUE
}
